<!DOCTYPE html>
<html>
<head>
  <!-- ============== Meta and Title ============== -->
  <meta charset="utf-8">
  <title>Sorbet</title>
  <meta content="HTML5, Bootstrap 3, Admin Template, UI Theme" name="keywords">
  <meta content="Alliance - A Responsive HTML5 Admin UI Framework" name="description">
  <meta content="ThemeREX" name="author">
  <meta content="width=device-width, initial-scale=1.0" name="viewport"><!-- ============== Fonts ============== -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,300,300italic,400italic,700,700italic' rel='stylesheet' type='text/css'><!-- ============== Icomoon ============== -->
  <link href="assets/fonts/icomoon/icomoon.css" rel="stylesheet" type="text/css"><!-- ============== FullCalendar ============== -->
  <link href="assets/js/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css">
  <link href="assets/js/plugins/magnific/magnific-popup.css" rel="stylesheet" type="text/css"><!-- ============== Plugins ============== -->
  <link href="assets/js/plugins/c3charts/c3.min.css" rel="stylesheet" type="text/css"><!-- ============== CSS - theme ============== -->
  <link href="assets/skin/default_skin/css/theme.css" rel="stylesheet" type="text/css"><!-- ============== CSS - allcp forms ============== -->
  <link href="assets/allcp/forms/css/forms.css" rel="stylesheet" type="text/css"><!-- ============== Favicon ============== -->
  <link href="assets/img/favicon.ico" rel="shortcut icon"><!-- ============== IE8 HTML5 support  ============== -->
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body class="dashboard-page">
  <!-- ============== Body Wrap  ============== -->
  <div id="main">
    <!-- ============== Header  ============== -->
    <header class="navbar bg-dark">
      <ul class="nav navbar-nav navbar-left">
        <li class="dropdown dropdown-fuse">
          <a aria-expanded="false" class="dropdown-toggle" href="#" role="button">Sorbet</a>
        </li>
      </ul>
      <form class="navbar-form navbar-right search-form square" role="search">
        <div class="input-group add-on">
          <input class="form-control" onblur="this.placeholder='Search...'" onfocus="this.placeholder=''" placeholder="Search..." type="text">
          <div class="input-group-btn">
            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
          </div>
        </div>
      </form>
    </header><!-- ============== /Header  ============== -->
    <!-- ============== Main Wrapper ============== -->
    <section id="content_wrapper">
      <!-- ============== Topbar ============== -->
      <header class="alt" id="topbar">
        <div class="topbar-left">
          <ol class="breadcrumb">
            <li class="breadcrumb-icon">
              <a href="dashboard1.html"><span class="fa fa-home"></span></a>
            </li>
            <li class="breadcrumb-active">
              <a href="dashboard1.html">Dashboard</a>
            </li>
            <li class="breadcrumb-link">
              <a href="index.html">Home</a>
            </li>
            <li class="breadcrumb-current-item">Dashboard</li>
          </ol>
        </div>
      </header><!-- ============== /Topbar ============== -->
      <!-- ============== Topbar Menu Wrapper ============== -->
      <div class="topbar-dropmenu-open" id="topbar-dropmenu-wrapper">
        <div class="topbar-menu row">
          <div class="col-xs-4 col-sm-2 col-sm-offset-3">
            <a class="service-box bg-danger" href="#" id="addSystemButton"><span class="fa fa-plus"></span> <span class="service-title">Add System</span></a>
          </div>
          <div class="col-xs-4 col-sm-2">
            <a class="service-box bg-system" href="#"><span class="fa fa-cog"></span> <span class="service-title">Settings</span></a>
          </div>
          <div class="col-xs-4 col-sm-2">
            <a class="service-box bg-dark" href="#"><span class="fa fa-user"></span> <span class="service-title">Users</span></a>
          </div>
        </div>
      </div><!-- ============== /Topbar Menu Wrapper ============== -->
      <!-- ============== Content ============== -->
      <section class="table-layout animated fadeIn" id="content">
        <!-- ============== Column Center ============== -->
        <div class="chute chute-center">
          <!-- ============== AllCP Info ============== -->
          <div class="allcp-panels fade-onload">
            <div class="row">
              <!-- ============== AllCP Grid ============== -->
              <div class="col-md-12 allcp-grid">
                <div class="panel">
                  <div class="panel-heading">
                    <span class="panel-title">System Status</span>
                  </div>
                  <div class="panel-body pn">
                    <div class="table-responsive">
                      <table class="table table-striped">
                        <thead class="bg-primary br6">
                          <tr class="br6">
                            <th class="br-t-l-r6 br-b-n lh25 pl30">Server Name</th>
                            <th class="br-b-n">Last Check</th>
                            <th class="br-t-r-r6 br-b-n">Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          {{#each this}}
                          <tr>
                            <td class="pl30"><a href="#/" class="clickHost" data-db-id="{{_id}}">{{host}}</a></td>
                            <td>{{#if lastCheck}} {{lastCheck}} {{else}} Not checked... {{/if}}</td>
                            <td><span class="label {{label}} ml5">{{statusText}}</span></td>
                          </tr>
                          {{/each}}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div><!-- ============== /AllCP Grid ============== -->
            </div>
          </div>
        </div><!-- ============== /Column Center ============== -->
        <div class="popup-basic p25 mfp-with-anim mfp-hide" id="modal-status">
          <h3 style="text-align: center">Service Status</h3>
          <h4 style="text-align: center"><span></span></h4>
          <table class="table table-striped">
            <thead class="bg-primary br6">
              <tr class="br6">
                <th class="br-t-l-r6 br-b-n lh25 pl30">Service</th>
                <th class="br-t-r-r6 br-b-n">Status</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
      <div class=" popup-basic allcp-form mfp-with-anim mfp-hide" id="modal-add-system">
        <div class="panel">
          <div class="panel-heading">
            <span class="panel-title"><i class="fa fa-rocket"></i>Add a system</span>
          </div><!-- ============== /Panel Heading ============== -->
          <form action="/" id="systemAddForm" method="post" name="systemAddForm" class="form-horizontal">
            <div class="panel-body ph15">
              <div class="alert alert-success light alert-dismissable" id="systemAddAlert" style="display:none;">
                <button aria-hidden="true" class="close" data-dismiss="alert" type="button">×</button>
              </div>
              <div class="section row">
                <div class="col-md-12 ph15">
                  <label class="field prepend-icon" for="host"><input class="gui-input" id="host" name="host" placeholder="Host with port..." type="text"> <label class="field-icon" for="host"><i class="fa fa-server"></i></label></label>
                </div>
              </div><!-- ============== /Section ============== -->
              <div class="section row">
                <div class="col-md-12 ph15">
                  <label class="field prepend-icon" for="username"><input class="gui-input" id="username" name="username" placeholder="Username..." type="text"> <label class="field-icon" for="username"><i class="fa fa-user"></i></label></label>
                </div>
              </div>
              <div class="section row">
                <div class="col-md-12 ph15">
                  <div class="form-group">
                    <label for="inputSelect" class="col-lg-3 control-label">Auth Type</label>
                    <div class="col-lg-8 ">

                      <div class="bs-component">
                        <select class="form-control" id="authSelector">
                          <option>
                            Password
                          </option>
                          <option>
                            Key
                          </option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="section row">
                <div class="col-md-12 ph15">
                  <label class="field prepend-icon" for="password" id="passContainer"><input class="gui-input" id="password" name="password" placeholder="Password..." type="password"> <label class="field-icon" for="password"><i class="fa fa-key"></i></label></label>
                  <textarea class="form-control" id="keyContainer" name="ssh_key" placeholder="SSH Key..." rows="3" style="display: none;"></textarea>
                </div>
              </div>
              <!--<div class="section row">
                <div class="col-sm-6 pl15">
                  <div class="checkbox-custom fill checkbox-primary mb5">
                    <input checked id="checkboxExample14" type="checkbox"> <label for="checkboxExample14">Standard Services</label>
                  </div>
                </div>
              </div>-->
            </div><!-- ============== /Form ============== -->
            <div class="panel-footer">
              <button class="button btn-primary" type="submit">Add System</button>
            </div><!-- ============== /Panel Footer ============== -->
          </form>
        </div><!-- ============== /Panel ============== -->
      </div><!-- ============== /Content ============== -->
      <!-- ============== Page Footer ============== -->
      <footer id="content-footer">
        <div class="row">
          <div class="col-md-6">
            <span class="footer-legal">© 2015 All rights reserved. <a href="#">Therms of use</a> and <a href="#">Privacy policy</a></span>
          </div>
        </div>
      </footer><!-- ============== /Page Footer ============== -->
    </section><!-- ============== /Main Wrapper ============== -->
  </div><!-- ============== /Body Wrap  ============== -->
  <!-- ============== Scripts ============== -->
  <!-- ============== jQuery ============== -->
  <script src="assets/js/jquery/jquery-1.11.3.min.js">
  </script>
  <script src="assets/js/jquery/jquery_ui/jquery-ui.min.js">
  </script> <!-- ============== HighCharts Plugin ============== -->

  <script src="assets/js/plugins/highcharts/highcharts.js">
  </script>
  <script src="assets/js/plugins/c3charts/d3.min.js">
  </script>
  <script src="assets/js/plugins/c3charts/c3.min.js">
  </script> <!-- ============== Simple Circles Plugin ============== -->

  <script src="assets/js/plugins/circles/circles.js">
  </script> <!-- ============== Maps JSs ============== -->

  <script src="assets/js/plugins/jvectormap/jquery.jvectormap.min.js">
  </script>
  <script src="assets/js/plugins/jvectormap/assets/jquery-jvectormap-us-lcc-en.js">
  </script> <!-- ============== FullCalendar Plugin ============== -->

  <script src="assets/js/plugins/fullcalendar/lib/moment.min.js">
  </script>
  <script src="assets/js/plugins/fullcalendar/fullcalendar.min.js">
  </script> <!-- ============== Date/Month - Pickers ============== -->

  <script src="assets/allcp/forms/js/jquery-ui-monthpicker.min.js">
  </script>
  <script src="assets/allcp/forms/js/jquery-ui-datepicker.min.js">
  </script> <!-- ============== Magnific Popup Plugin ============== -->

  <script src="assets/js/plugins/magnific/jquery.magnific-popup.js">
  </script> <!-- ============== Theme Scripts ============== -->

  <script src="assets/js/utility/utility.js">
  </script>
  <script src="assets/js/demo/demo.js">
  </script>
  <script src="assets/js/main.js">
  </script> <!-- ============== Widget JS ============== -->

  <script src="assets/js/demo/widgets.js">
  </script>
  <script src="assets/js/demo/widgets_sidebar.js">
  </script>
  <script src="assets/js/pages/dashboard1.js">
  </script> <!-- ============== /Scripts ============== -->

  <script>
    $(document).ready(function() {
      $("#authSelector").on('change', function (e) {
        var optionSelected = $("option:selected", this);
        var valueSelected = this.value;
        if(valueSelected == "Password"){
          $("#passContainer").show();
          $("#keyContainer").hide();
        } else {
          $("#passContainer").hide();
          $("#keyContainer").show();
        }
      });
      $("#systemAddForm").submit(function(e){
        e.preventDefault();
        var payload = {
          host: $("input[name='host']").val(),
          username: $("input[name='username']").val(),
        };

        var valueSelected = $("#authSelector").val()
        if(valueSelected == "Password"){
          payload.password = $("input[name='password']").val()
        } else if(valueSelected == "Key"){
          payload.ssh_key = $("textarea[name='ssh_key']").val()
        } else {
          alert("Password or SSH Key must be selected");
          return;
        }

        $.post("/svc/systems", payload, function(res){
          $("#systemAddAlert").slideUp(function(){
            $("#systemAddAlert").text(res.message)
            $("#systemAddAlert").switchClass('alert-danger', 'alert-success')
            $("#systemAddAlert").slideDown();
          });
        }).fail(function(res) {
          $("#systemAddAlert").slideUp(function(){
            $("#systemAddAlert").text(res.responseJSON.message)
            $("#systemAddAlert").switchClass('alert-success', 'alert-danger')
            $("#systemAddAlert").slideDown();
          });
        });
      })
      $("#addSystemButton").click(function(e) {
        $.magnificPopup.open({
          removalDelay: 500,
          items: {
            src: "#modal-add-system"
          },
          callbacks: {
            beforeOpen: function(e) {
              var Animation = $("#animation-switcher").find('.active-animation').attr('data-effect');
              this.st.mainClass = "mfp-flipInY";
            },
            close: function(e){
              $("#systemAddForm")[0].reset();
              $("#authSelector").val('Password')
              $("#passContainer").show();
              $("#keyContainer").hide();
            }
          },
          midClick: true
        });
      });
      $(".clickHost").click(function(e) {
        e.preventDefault();
        $.get("/svc/systems/" + $(this).data("db-id"), function(res) {

          $.magnificPopup.open({
            removalDelay: 500,
            items: {
              src: "#modal-status"
            },
            callbacks: {
              beforeOpen: function(e) {
                var Animation = $("#animation-switcher").find('.active-animation').attr('data-effect');
                this.st.mainClass = "mfp-flipInY";
              }
            },
            midClick: true
          });
          $("#modal-status table tbody").children().remove();
          res.checks.forEach(function(check) {
            var status = "",
              btnClass = "";
            switch (check.status) {
              case 0:
                status = "Running";
                btnClass = "btn-success"
                break;

              case 1:
                status = "Stopped";
                btnClass = "btn-danger"
                break;

              case -1:
                status = "Unknown";
                btnClass = "btn-info"
                break;
            }

            var row = "<tr><td class='pl30'>" + check.name + "<\/td><td><button type='button' class='btn " + btnClass + " dropdown-toggle' data-toggle='dropdown'>" + status + "  <\/button><\/td><\/tr>"

            $("#modal-status table tbody").append(row);

          })
          $("#modal-status h4 span").text(res.host.split(":")[0]);
        }, "json")
      })
    })
  </script>
</body>
</html>
