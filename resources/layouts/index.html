<!DOCTYPE html>
<html>

<head>
  <!-- -------------- Meta and Title -------------- -->
  <meta charset="utf-8">
  <title>Sorbet</title>
  <meta name="keywords" content="HTML5, Bootstrap 3, Admin Template, UI Theme" />
  <meta name="description" content="Alliance - A Responsive HTML5 Admin UI Framework">
  <meta name="author" content="ThemeREX">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- -------------- Fonts -------------- -->
  <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700'>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,300,300italic,400italic,700,700italic' rel='stylesheet' type='text/css'>

  <!-- -------------- Icomoon -------------- -->
  <link rel="stylesheet" type="text/css" href="assets/fonts/icomoon/icomoon.css">

  <!-- -------------- FullCalendar -------------- -->
  <link rel="stylesheet" type="text/css" href="assets/js/plugins/fullcalendar/fullcalendar.min.css">
  <link rel="stylesheet" type="text/css" href="assets/js/plugins/magnific/magnific-popup.css">

  <!-- -------------- Plugins -------------- -->
  <link rel="stylesheet" type="text/css" href="assets/js/plugins/c3charts/c3.min.css">

  <!-- -------------- CSS - theme -------------- -->
  <link rel="stylesheet" type="text/css" href="assets/skin/default_skin/css/theme.css">

  <!-- -------------- CSS - allcp forms -------------- -->
  <link rel="stylesheet" type="text/css" href="assets/allcp/forms/css/forms.css">

  <!-- -------------- Favicon -------------- -->
  <link rel="shortcut icon" href="assets/img/favicon.ico">

  <!-- -------------- IE8 HTML5 support  -------------- -->
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body class="dashboard-page">


  <!-- -------------- Body Wrap  -------------- -->
  <div id="main">

    <!-- -------------- Header  -------------- -->
    <header class="navbar  bg-dark">

      <ul class="nav navbar-nav navbar-left">
        <li class="dropdown dropdown-fuse">
          <a href="#" class="dropdown-toggle" role="button" aria-expanded="false">Sorbet
              </a>
        </li>
        <li class="hidden-xs">
          <a class="navbar-fullscreen toggle-active" href="#">
            <span class="glyphicon glyphicon-fullscreen"></span>
          </a>
        </li>
      </ul>
      <form class="navbar-form navbar-right search-form square" role="search">
        <div class="input-group add-on">

          <input type="text" class="form-control" placeholder="Search..." onfocus="this.placeholder=''" onblur="this.placeholder='Search...'">

          <div class="input-group-btn">
            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
          </div>

        </div>
      </form>
    </header>
    <!-- -------------- /Header  -------------- -->

    <!-- -------------- Main Wrapper -------------- -->
    <section id="content_wrapper">
      <!-- -------------- Topbar -------------- -->
      <header id="topbar" class="alt">
        <div class="topbar-left">
          <ol class="breadcrumb">
            <li class="breadcrumb-icon">
              <a href="dashboard1.html">
                <span class="fa fa-home"></span>
              </a>
            </li>
            <li class="breadcrumb-active">
              <a href="dashboard1.html">Dashboard</a>
            </li>
            <li class="breadcrumb-link">
              <a href="index.html">Home</a>
            </li>
            <li class="breadcrumb-current-item">Dashboard</li>
          </ol>
        </div>

      </header>
      <!-- -------------- /Topbar -------------- -->

      <!-- -------------- Topbar Menu Wrapper -------------- -->
      <div id="topbar-dropmenu-wrapper" class="topbar-dropmenu-open">

        <div class="topbar-menu row">
          <div class="col-xs-4 col-sm-2 col-sm-offset-3">
            <a id="addSystemButton" href="#" class="service-box bg-danger">
              <span class="fa fa-plus"></span>
              <span class="service-title">Add System</span>
            </a>
          </div>
          <div class="col-xs-4 col-sm-2">
            <a href="#" class="service-box bg-system">
              <span class="fa fa-cog"></span>
              <span class="service-title">Settings</span>
            </a>
          </div>
          <div class="col-xs-4 col-sm-2">
            <a href="#" class="service-box bg-dark">
              <span class="fa fa-user"></span>
              <span class="service-title">Users</span>
            </a>
          </div>
        </div>
      </div>
      <!-- -------------- /Topbar Menu Wrapper -------------- -->

      <!-- -------------- Content -------------- -->
      <section id="content" class="table-layout animated fadeIn">

        <!-- -------------- Column Center -------------- -->
        <div class="chute chute-center">

          <!-- -------------- AllCP Info -------------- -->
          <div class="allcp-panels fade-onload">

            <div class="row">

              <!-- -------------- AllCP Grid -------------- -->
              <div class="col-md-12 allcp-grid">

                <div class="panel">
                  <div class="panel-heading">
                    <span class="panel-title">System Status</span>
                  </div>
                  <div class="panel-body pn">
                    <div class="table-responsive">
                      <table class="table table-striped">
                        <thead class="bg-primary br6">
                          <tr class="br6">
                            <th class="br-t-l-r6 br-b-n lh25 pl30">Server Name</th>
                            <th class="br-b-n">Last Check</th>
                            <th class="br-t-r-r6 br-b-n">Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          {{#each this}}
                          <tr>
                            <td class="pl30"><a href="#/" class="clickHost" data-db-id="{{_id}}">{{host}}</a></td>
                            <td>{{#if lastCheck}} {{lastCheck}} {{else}} Not checked... {{/if}}</td>
                            <td><span class="label {{label}} ml5">{{statusText}}</span></td>
                          </tr>
                          {{/each}}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              <!-- -------------- /AllCP Grid -------------- -->
            </div>
          </div>
        </div>
        <!-- -------------- /Column Center -------------- -->

        <div id="modal-status" class="popup-basic p25 mfp-with-anim mfp-hide">
          <h3 style="text-align: center">Service Status</h3>
          <h4 style="text-align: center"><span></span></h5>
          <table class="table table-striped">
            <thead class="bg-primary br6">
              <tr class="br6">
                <th class="br-t-l-r6 br-b-n lh25 pl30">Service</th>
                <th class="br-t-r-r6 br-b-n">Status</th>
              </tr>
            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
      </section>

      <div id="modal-add-system" class=" popup-basic allcp-form mfp-with-anim mfp-hide">
                <div class="panel">
                    <div class="panel-heading">
              <span class="panel-title">
                <i class="fa fa-rocket"></i>Add a system</span>
                    </div>
                    <!-- -------------- /Panel Heading -------------- -->

                    <form method="post" action="/" id="systemAddForm">
                        <div class="panel-body ph15">
                          <div class="alert alert-success light alert-dismissable" style="display:none;" id="systemAddAlert">
                            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                          </div>
                            <div class="section row">
                                <div class="col-md-12 ph15">
                                    <label for="host" class="field prepend-icon">
                                        <input type="text" name="host" id="host" class="gui-input"
                                               placeholder="Host with port...">
                                        <label for="host" class="field-icon">
                                            <i class="fa fa-server"></i>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            <!-- -------------- /Section -------------- -->

                            <div class="section row">
                              <div class="col-md-12 ph15">
                                  <label for="username" class="field prepend-icon">
                                      <input type="text" name="username" id="username" class="gui-input"
                                             placeholder="Username...">
                                      <label for="username" class="field-icon">
                                          <i class="fa fa-user"></i>
                                      </label>
                                  </label>
                              </div>
                            </div>

                            <div class="section row">
                              <div class="col-md-12 ph15">
                                  <label for="password" class="field prepend-icon">
                                      <input type="password" name="password" id="password" class="gui-input"
                                             placeholder="Password...">
                                      <label for="password" class="field-icon">
                                          <i class="fa fa-key"></i>
                                      </label>
                                  </label>
                              </div>
                            </div>

                        </div>
                        <!-- -------------- /Form -------------- -->

                        <div class="panel-footer">
                            <button type="submit" class="button btn-primary">Add System</button>
                        </div>
                        <!-- -------------- /Panel Footer -------------- -->
                    </form>
                </div>
                <!-- -------------- /Panel -------------- -->
            </div>
      <!-- -------------- /Content -------------- -->

      <!-- -------------- Page Footer -------------- -->
      <footer id="content-footer">
        <div class="row">
          <div class="col-md-6">
            <span class="footer-legal">© 2015 All rights reserved. <a href="#">Therms of use</a> and <a
                            href="#">Privacy policy</a></span>
          </div>
        </div>
      </footer>
      <!-- -------------- /Page Footer -------------- -->

    </section>
    <!-- -------------- /Main Wrapper -------------- -->

  </div>
  <!-- -------------- /Body Wrap  -------------- -->

  <!-- -------------- Scripts -------------- -->

  <!-- -------------- jQuery -------------- -->
  <script src="assets/js/jquery/jquery-1.11.3.min.js"></script>
  <script src="assets/js/jquery/jquery_ui/jquery-ui.min.js"></script>

  <!-- -------------- HighCharts Plugin -------------- -->
  <script src="assets/js/plugins/highcharts/highcharts.js"></script>
  <script src="assets/js/plugins/c3charts/d3.min.js"></script>
  <script src="assets/js/plugins/c3charts/c3.min.js"></script>

  <!-- -------------- Simple Circles Plugin -------------- -->
  <script src="assets/js/plugins/circles/circles.js"></script>

  <!-- -------------- Maps JSs -------------- -->
  <script src="assets/js/plugins/jvectormap/jquery.jvectormap.min.js"></script>
  <script src="assets/js/plugins/jvectormap/assets/jquery-jvectormap-us-lcc-en.js"></script>

  <!-- -------------- FullCalendar Plugin -------------- -->
  <script src="assets/js/plugins/fullcalendar/lib/moment.min.js"></script>
  <script src="assets/js/plugins/fullcalendar/fullcalendar.min.js"></script>

  <!-- -------------- Date/Month - Pickers -------------- -->
  <script src="assets/allcp/forms/js/jquery-ui-monthpicker.min.js"></script>
  <script src="assets/allcp/forms/js/jquery-ui-datepicker.min.js"></script>

  <!-- -------------- Magnific Popup Plugin -------------- -->
  <script src="assets/js/plugins/magnific/jquery.magnific-popup.js"></script>

  <!-- -------------- Theme Scripts -------------- -->
  <script src="assets/js/utility/utility.js"></script>
  <script src="assets/js/demo/demo.js"></script>
  <script src="assets/js/main.js"></script>

  <!-- -------------- Widget JS -------------- -->
  <script src="assets/js/demo/widgets.js"></script>
  <script src="assets/js/demo/widgets_sidebar.js"></script>
  <script src="assets/js/pages/dashboard1.js"></script>
  <!-- -------------- /Scripts -------------- -->

  <script>
    $(document).ready(function() {
      $("#systemAddForm").submit(function(e){
        e.preventDefault();
        $.post("/svc/systems", $(this).serialize(), function(res){
          $("#systemAddAlert").slideUp(function(){
            $("#systemAddAlert").text(res.message)
            $("#systemAddAlert").switchClass('alert-danger', 'alert-success')
            $("#systemAddAlert").slideDown();
          });
        }).fail(function(res) {
          $("#systemAddAlert").slideUp(function(){
            $("#systemAddAlert").text(res.responseJSON.message)
            $("#systemAddAlert").switchClass('alert-success', 'alert-danger')
            $("#systemAddAlert").slideDown();
          });
        });
      })
      $("#addSystemButton").click(function(e) {
        $.magnificPopup.open({
          removalDelay: 500,
          items: {
            src: "#modal-add-system"
          },
          callbacks: {
            beforeOpen: function(e) {
              var Animation = $("#animation-switcher").find('.active-animation').attr('data-effect');
              this.st.mainClass = "mfp-flipInY";
            }
          },
          midClick: true
        });
      });
      $(".clickHost").click(function(e) {
        e.preventDefault();
        $.get("/svc/systems/" + $(this).data("db-id"), function(res) {

          $.magnificPopup.open({
            removalDelay: 500,
            items: {
              src: "#modal-status"
            },
            callbacks: {
              beforeOpen: function(e) {
                var Animation = $("#animation-switcher").find('.active-animation').attr('data-effect');
                this.st.mainClass = "mfp-flipInY";
              }
            },
            midClick: true
          });
          $("#modal-status table tbody").children().remove();
          res.checks.forEach(function(check) {
            var status = "",
              btnClass = "";
            switch (check.status) {
              case 0:
                status = "Running";
                btnClass = "btn-success"
                break;

              case 1:
                status = "Stopped";
                btnClass = "btn-danger"
                break;

              case -1:
                status = "Unknown";
                btnClass = "btn-info"
                break;
            }

            var row = "<tr><td class='pl30'>" + check.name + "</td><td><button type='button' class='btn " + btnClass + " dropdown-toggle' data-toggle='dropdown'>" + status + "  </button></td></tr>"

            $("#modal-status table tbody").append(row);

          })
          $("#modal-status h4 span").text(res.host.split(":")[0]);
        }, "json")
      })
    })
  </script>

</body>

</html>
